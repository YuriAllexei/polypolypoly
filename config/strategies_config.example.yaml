# Sniper Strategies Configuration
# This config is used by the sniper binary

# Log level: error, warn, info, debug, trace
log_level: "info"

# Component settings (shared infrastructure)
components:
  balance_manager:
    # Halt threshold as fraction (0.10 = halt if balance drops below 10% of peak)
    threshold: 0.10

# Up or Down strategy settings
up_or_down:
  # Time window in seconds before market ends to trigger alert
  delta_t_seconds: 700
  # Fraction of collateral to use per order (e.g., 0.10 = 10%)
  order_pct_of_collateral: 0.10
  # How often to poll database for new markets (seconds)
  poll_interval_secs: 0.2
  # Minimum price difference in basis points between oracle and market for trade signal
  # (bypassable in final 5 seconds)
  oracle_bps_price_threshold: 100.0
  # Guardian safety threshold in basis points - cancels orders if oracle is within this
  # distance of price_to_beat. Never bypassed, runs until market timer ends.
  guardian_safety_bps: 2.0

  # Dynamic threshold parameters (exponential decay based on time to market end)
  # Formula: threshold = min + (max - min) * (1 - exp(-time_remaining / tau))
  # Minimum threshold in seconds (when close to market end - more aggressive)
  threshold_min: 0.1
  # Maximum threshold in seconds (when far from market end - more conservative)
  threshold_max: 10.0
  # Decay time constant in seconds (controls how fast threshold decreases)
  threshold_tau: 15.0

# Sports Sniping strategy settings
sports_sniping:
  # How often to poll for updates (seconds)
  poll_interval_secs: 1.0
  # Enable/disable the strategy
  enabled: true
  # Fraction of collateral to use per order (e.g., 0.10 = 10%)
  order_pct_of_collateral: 0.10
  # Minimum best bid price to execute (e.g., 0.80 = only sell if bid > $0.80)
  bid_threshold: 0.80

# Inventory MM strategy settings
inventory_mm:
  # === Market Selection ===
  # Which markets to track (symbol, timeframe, count of upcoming markets)
  # Supported: BTC/ETH with 15M/1H timeframes (hardcoded in DB query)
  markets:
    - symbol: "BTC"
      timeframe: "15M"
      count: 3
    - symbol: "ETH"
      timeframe: "15M"
      count: 3
    - symbol: "BTC"
      timeframe: "1H"
      count: 2
    - symbol: "ETH"
      timeframe: "1H"
      count: 2

  # === Timing ===
  # How often to poll DB for new markets (seconds)
  poll_interval_secs: 30
  # Quoter tick interval (milliseconds)
  # WARNING: WebSocket fill notifications have 200-500ms latency. Setting this too low
  # causes orders to be placed based on stale position data, leading to massive imbalance.
  # Minimum enforced: 100ms. Recommended: 500ms for safety.
  tick_interval_ms: 500
  # WebSocket snapshot timeout (seconds)
  snapshot_timeout_secs: 30
  # Cooldown between merges (seconds)
  merge_cooldown_secs: 120

  # === Solver (Quoting Parameters) ===
  solver:
    # Number of bid levels per side
    num_levels: 3
    # Tick size for price rounding
    tick_size: 0.01
    # Base offset from best ask when delta=0 (aggressive)
    base_offset: 0.01
    # Minimum profit margin required (1 cent per pair)
    min_profit_margin: 0.01
    # Maximum imbalance before stopping quotes on overweight side (80%)
    max_imbalance: 0.8
    # Order size per level (tokens)
    order_size: 100.0
    # Spread adjustment per level (cents)
    spread_per_level: 1.0
    # Multiplier for offset scaling with imbalance
    offset_scaling: 5.0
    # Skew factor for size adjustment (0.0 = none, 1.0 = moderate, 2.0 = aggressive)
    skew_factor: 1.0

  # === Merger (Merge Conditions) ===
  merger:
    # Minimum pairs before considering a merge
    min_merge_size: 10.0
    # Maximum imbalance allowed for merge (30%)
    max_merge_imbalance: 0.3
    # Minimum profit margin required
    min_profit_margin: 0.01
    # Maximum combined avg cost (1.0 - min_profit_margin)
    max_combined_cost: 0.99

  # === Taker (Immediate FOK Execution) ===
  taker:
    # Enable/disable taker functionality
    enabled: true
    # Tick interval for checking opportunities (milliseconds)
    tick_interval_ms: 100
    # Minimum delta threshold to trigger (0.1 = 10% imbalance)
    min_delta_threshold: 0.1
    # Maximum size per taker order
    max_take_size: 100.0
    # Minimum size per taker order
    min_take_size: 1.0
    # Maximum combined avg cost (0.99 = require 1% profit margin)
    max_combined_avg: 0.99