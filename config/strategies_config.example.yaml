# Sniper Strategies Configuration
# This config is used by the sniper binary

# Log level: error, warn, info, debug, trace
log_level: "info"

# Component settings (shared infrastructure)
components:
  balance_manager:
    # Halt threshold as fraction (0.10 = halt if balance drops below 10% of peak)
    threshold: 0.10

# Up or Down strategy settings
up_or_down:
  # Time window in seconds before market ends to trigger alert
  delta_t_seconds: 700
  # Fraction of collateral to use per order (e.g., 0.10 = 10%)
  order_pct_of_collateral: 0.10
  # How often to poll database for new markets (seconds)
  poll_interval_secs: 0.2
  # Minimum price difference in basis points between oracle and market for trade signal
  # (bypassable in final 5 seconds)
  oracle_bps_price_threshold: 100.0
  # Guardian safety threshold in basis points - cancels orders if oracle is within this
  # distance of price_to_beat. Never bypassed, runs until market timer ends.
  guardian_safety_bps: 2.0

  # Dynamic threshold parameters (exponential decay based on time to market end)
  # Formula: threshold = min + (max - min) * (1 - exp(-time_remaining / tau))
  # Minimum threshold in seconds (when close to market end - more aggressive)
  threshold_min: 0.1
  # Maximum threshold in seconds (when far from market end - more conservative)
  threshold_max: 10.0
  # Decay time constant in seconds (controls how fast threshold decreases)
  threshold_tau: 15.0

# Sports Sniping strategy settings
sports_sniping:
  # How often to poll for updates (seconds)
  poll_interval_secs: 1.0
  # Enable/disable the strategy
  enabled: true
  # Fraction of collateral to use per order (e.g., 0.10 = 10%)
  order_pct_of_collateral: 0.10
  # Minimum best bid price to execute (e.g., 0.80 = only sell if bid > $0.80)
  bid_threshold: 0.80

# Inventory MM strategy settings
inventory_mm:
  # === Market Selection ===
  # Which markets to track (symbol, timeframe, count of upcoming markets)
  # Supported: BTC/ETH with 15M/1H timeframes (hardcoded in DB query)
  markets:
    - symbol: "BTC"
      timeframe: "15M"
      count: 3
    - symbol: "ETH"
      timeframe: "15M"
      count: 3
    - symbol: "BTC"
      timeframe: "1H"
      count: 2
    - symbol: "ETH"
      timeframe: "1H"
      count: 2

  # === Timing ===
  # How often to poll DB for new markets (seconds)
  poll_interval_secs: 30
  # Quoter tick interval (milliseconds)
  # WARNING: WebSocket fill notifications have 200-500ms latency. Setting this too low
  # causes orders to be placed based on stale position data, leading to massive imbalance.
  # Minimum enforced: 100ms. Recommended: 500ms for safety.
  tick_interval_ms: 500
  # WebSocket snapshot timeout (seconds)
  snapshot_timeout_secs: 30
  # Cooldown between merges (seconds)
  merge_cooldown_secs: 120

  # === Solver (4-Layer Quoter Parameters) ===
  # Implements O'Hara Market Microstructure theory with oracle-based adjustments
  solver:
    # === General Parameters ===
    # Number of bid levels per side
    num_levels: 3
    # Tick size for price rounding
    tick_size: 0.01
    # Base order size when inventory is balanced (tokens)
    order_size: 100.0
    # Spread adjustment per level (cents)
    spread_per_level: 1.0
    # Minimum offset from best_bid to prevent crossing spread
    min_offset: 0.01
    # Maximum position size per side (UP/DOWN) - stops quoting when reached
    # Set to 0 for unlimited. This is a safety limit for testing.
    max_position: 200.0
    # Maximum imbalance before stopping quotes on overweight side (80%)
    max_imbalance: 0.8

    # === Layer 1: Oracle-Adjusted Offset ===
    # Adjusts quote offset based on ChainLink oracle distance from threshold
    # Formula: oracle_adj = oracle_distance_pct * oracle_sensitivity
    # Higher = more aggressive adjustment based on oracle signal
    oracle_sensitivity: 5.0

    # === Layer 2: Adverse Selection (Glosten-Milgrom) ===
    # Widens spread near resolution when informed traders are more likely
    # Formula: p_informed = p_informed_base * exp(-minutes / time_decay_minutes)
    #          spread = base_spread * (1 + 3 * p_informed)
    # Base spread before adverse selection adjustment (e.g., 0.02 = 2 cents)
    base_spread: 0.02
    # Base probability of informed trader (e.g., 0.2 = 20%)
    p_informed_base: 0.2
    # Time decay constant in minutes (lower = faster increase near resolution)
    time_decay_minutes: 5.0

    # === Layer 3: Inventory Skew ===
    # Adjusts offset and size based on inventory imbalance
    # Offset formula: spread_mult = 1 + gamma_inv * q (where q = delta)
    # Size formula: size = order_size * exp(-lambda_size * q)
    # Gamma for offset multiplier (higher = more aggressive offset adjustment)
    gamma_inv: 1.5
    # Lambda for size decay (higher = more aggressive size reduction when overweight)
    lambda_size: 1.5

    # === Layer 4: Edge Check ===
    # Skips quotes that don't have sufficient edge (profit margin)
    # Formula: skip if (best_ask - bid_price) < edge_threshold
    edge_threshold: 0.01

  # === Merger (Merge Conditions) ===
  merger:
    # Minimum pairs before considering a merge
    min_merge_size: 10.0
    # Maximum imbalance allowed for merge (30%)
    max_merge_imbalance: 0.3
    # Minimum profit margin required
    min_profit_margin: 0.01
    # Maximum combined avg cost (1.0 - min_profit_margin)
    max_combined_cost: 0.99

  # === Taker (Immediate FOK Execution) ===
  taker:
    # Enable/disable taker functionality
    enabled: true
    # Tick interval for checking opportunities (milliseconds)
    tick_interval_ms: 100
    # Minimum delta threshold to trigger (0.1 = 10% imbalance)
    min_delta_threshold: 0.1
    # Maximum size per taker order
    max_take_size: 100.0
    # Minimum size per taker order
    min_take_size: 1.0
    # Maximum combined avg cost (0.99 = require 1% profit margin)
    max_combined_avg: 0.99